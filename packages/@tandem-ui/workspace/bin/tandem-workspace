#!/usr/bin/env node
const yargs = require("yargs");
const { start, Server } = require("../lib/server.js");
const execa = require("execa");

yargs.command(
  "start [project-source]",
  `start workspace`,
  (yargs) => {
    return yargs
      .option("port")
      .option("open")
      .option("autoSave")
      .option("branch");
  },
  ({ projectSource, port, open, autoSave, branch }) => {
    let _server;

    start({
      cwd: process.cwd(),
      autoSave,
      branch,
      http: {
        port: port,
      },
      project: {
        installDependencies: false,
      },
    })
      .then((server) => {
        _server = server;
        if (projectSource) {
          return server.getWorkspace().start(projectSource);
        }
      })
      .then((project) => {
        if (open && project) {
          if (open) {
            execa(`open`, [
              `http://localhost:${_server.getPort()}?projectId=${project.getId()}`,
            ]);
          }
        }
      });
  }
).argv;
